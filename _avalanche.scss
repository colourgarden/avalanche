/*! Avalanche | MIT License | @colourgarden */

/*------------------------------------*\
    SETTINGS
\*------------------------------------*/

$av-namespace:              'grid' !default;      // Prefix namespace for grid layout and cells
$av-element-name:           'cell' !default;      // Element/cell name
$av-element-class-chain:    '__' !default;        // Chain characters between block and element
$av-modifier-class-chain:   '--' !default;        // Chain characters between block and modifier
$av-breakpoint-class-chain: '--' !default;        // Chain characters between width and breakpoint

$av-gutter:                 20px !default;        // Gutter between grid cells

$av-width-class-namespace:  '' !default;          // Prefix namespace for width classes. For example; 'col-'
$av-width-class-style:      'fraction' !default;  // Width class naming style. Can be 'fraction', 'percentage' or 'fragment'
$av-widths: (
  2,
  3,
  4
) !default; // Width denominator values. 2 = 1/2, 3 = 1/3 etc. Add/remove as appropriate

$av-enable-responsive:  true !default;
$av-breakpoints:  (
  "thumb":            "screen and (max-width: 499px)",
  "handheld":         "screen and (min-width: 500px) and (max-width: 800px)",
  "handheld-and-up":  "screen and (min-width: 500px)",
  "pocket":           "screen and (max-width: 800px)",
  "lap":              "screen and (min-width: 801px) and (max-width: 1024px)",
  "lap-and-up":       "screen and (min-width: 801px)",
  "portable":         "screen and (max-width: 1024px)",
  "desk":             "screen and (min-width: 1025px)",
  "widescreen":       "screen and (min-width: 1160px)",
  "retina":           "screen and (-webkit-min-device-pixel-ratio: 2), screen and (min-resolution: 192dpi), screen and (min-resolution: 2dppx)"
) !default; // Responsive breakpoints. Add/remove as appropriate

// Enable/disable grid layouts
$av-enable-grid-center:       false !default;
$av-enable-grid-cell-center:  false !default;
$av-enable-grid-right:        false !default;
$av-enable-grid-middle:       false !default;
$av-enable-grid-bottom:       false !default;
$av-enable-grid-flush:        false !default;
$av-enable-grid-tiny:         false !default;
$av-enable-grid-small:        false !default;
$av-enable-grid-large:        false !default;
$av-enable-grid-huge:         false !default;
$av-enable-grid-auto:         false !default;
$av-enable-grid-rev:          false !default;
$av-enable-debug:             true !default;





/*------------------------------------*\
    LOGIC aka THE MAGIC
\*------------------------------------*/

@function escapeNumerator($numerator, $namespace: ''){
  @if($namespace == ''){
    $numerator-as-string: inspect($numerator);
    $escaped-numerator: '';

    // Loop through all digits in the numerator and escape individually
    @for $i from 1 through str-length($numerator-as-string){
      $digit: str-slice($numerator-as-string, $i, $i);
      $escaped-numerator: $escaped-numerator+\3+$digit;
    }

    @return $escaped-numerator;
  } @else {
    @return $numerator;
  }
}

@function avCreateWidthClassName($style, $numerator, $denominator, $breakpoint-alias){

  $class-name: null;

  @if $style == 'fraction' or $style == 'fragment'{
    // Set delimiter as slash or text
    $delimiter: if($style == 'fraction', \/, -of-);
    $class-name: #{$av-width-class-namespace}#{escapeNumerator($numerator, $av-width-class-namespace)}#{$delimiter}#{$denominator}#{$breakpoint-alias};
  } @else{
    @if $av-width-class-namespace == ''{
      @error "Percentage value class names require a namespace to be set (see $av-width-class-namespace). Selective escaping (e.g. the 5 of 50) cannot be done.";
    }
    $class-width: floor(($numerator / $denominator) * 100);
    $class-name: #{$av-width-class-namespace}#{$class-width}#{$breakpoint-alias};
  }

  @return $class-name;
}

@function avCreateBlockClassName($modifier: ''){
  @if $modifier == '' {
    @return #{$av-namespace};
  }

  @return #{$av-namespace}#{$av-modifier-class-chain}#{$modifier};
}

@function avCreateElementClassName($modifier: ''){
  @if $modifier == '' {
    @return #{$av-namespace}#{$av-element-class-chain}#{$av-element-name};
  }

  @return #{$av-namespace}#{$av-element-class-chain}#{$av-element-name}#{$av-modifier-class-chain}#{$modifier};

}

@mixin av-create-widths($widths, $breakpoint-alias: null){

  // Initialise an empty utility map that will eventually contain all our classes
  $pseudo-class-map: ();

  // Loop widths
  @each $denominator in $widths{

    // If 1=1, 2=2, 3=3; @for will skip over so create 1/1 class manually
    @if ($denominator == 1) {

      // Create 1/1 class
      $class-name: avCreateWidthClassName($av-width-class-style, 1, 1, $breakpoint-alias);
      .#{$class-name}{
        width: 100%;
      }

    } @else {

      // Loop widths as fractions
      @for $numerator from 1 to $denominator{

        // Create class name and set width value
        $class-name: avCreateWidthClassName($av-width-class-style, $numerator,$denominator, $breakpoint-alias);
        $width-value: percentage($numerator / $denominator);

        // Is this width already in our utility map?
        $duplicate: map-get($pseudo-class-map, $width-value);

        // Create width class
        .#{$class-name}{

          // If this width is in utility map, @extend the duplicate, else create a new one
          @if $duplicate{
            @extend .#{$duplicate};
          } @else{
            width: $width-value;
          }
        }

        // Add this class to utility map
        $add-class: ($width-value: $class-name);
        $pseudo-class-map: map-merge($pseudo-class-map, $add-class);
      }
    }
  }
}

@mixin av-mq($alias){

  // Search breakpoint map for alias
  $query: map-get($av-breakpoints, $alias);

  // If alias exists, print out media query
  @if $query{
    @media #{$query}{
      @content;
    }
  } @else{
    @error "No breakpoint found for #{$alias}";
  }
}





/*------------------------------------*\
    GRID LAYOUT
\*------------------------------------*/

.#{avCreateBlockClassName()}{
  display: block;
  list-style: none;
  padding: 0;
  margin: 0;
  margin-left: -($av-gutter);
  font-size: 0rem;
}

.#{avCreateElementClassName()}{
  box-sizing: border-box;
  display: inline-block;
  width: 100%;
  padding: 0;
  padding-left: $av-gutter;
  margin: 0;
  vertical-align: top;
  font-size: 1rem;
}

@if $av-enable-grid-center{

  .#{avCreateBlockClassName('center')}{
    text-align: center;

    > .#{avCreateElementClassName()}{
      text-align: left;
    }
  }
}

@if $av-enable-grid-cell-center{

  .#{avCreateElementClassName('center')}{
    display: block;
    margin: 0 auto;
  }
}

@if $av-enable-grid-right{

  .#{avCreateBlockClassName('right')}{
    text-align: right;

    > .#{avCreateElementClassName()}{
      text-align: left;
    }
  }
}

@if $av-enable-grid-middle{

  .#{avCreateBlockClassName('middle')}{

    > .#{avCreateElementClassName()}{
      vertical-align: middle;
    }
  }
}

@if $av-enable-grid-bottom{

  .#{avCreateBlockClassName('bottom')}{

    > .#{avCreateElementClassName()}{
      vertical-align: bottom;
    }
  }
}

@if $av-enable-grid-flush{

  .#{avCreateBlockClassName('flush')}{
    margin-left: 0;

    > .#{avCreateElementClassName()}{
      padding-left: 0;
    }
  }
}

@if $av-enable-grid-tiny{

  .#{avCreateBlockClassName('tiny')}{
    margin-left: -($av-gutter / 4);

    > .#{avCreateElementClassName()}{
      padding-left: ($av-gutter / 4);
    }
  }
}

@if $av-enable-grid-small{

  .#{avCreateBlockClassName('small')}{
    margin-left: -($av-gutter / 2);

    > .#{avCreateElementClassName()}{
      padding-left: ($av-gutter / 2);
    }
  }
}

@if $av-enable-grid-large{

  .#{avCreateBlockClassName('large')}{
    margin-left: -($av-gutter * 2);

    > .#{avCreateElementClassName()}{
      padding-left: ($av-gutter * 2);
    }
  }
}

@if $av-enable-grid-huge{

  .#{avCreateBlockClassName('huge')}{
    margin-left: -($av-gutter * 4);

    > .#{avCreateElementClassName()}{
      padding-left: ($av-gutter * 4);
    }
  }
}

@if $av-enable-grid-auto{

  .#{avCreateBlockClassName('auto')}{

    > .#{avCreateElementClassName()}{
      width: auto;
    }
  }
}

@if $av-enable-grid-rev{

  .#{avCreateBlockClassName('rev')}{
    direction: rtl;

    > .#{avCreateElementClassName()}{
      direction: ltr;
    }
  }
}





/*------------------------------------*\
    GRID WIDTHS
\*------------------------------------*/

// Loop default widths
@include av-create-widths($av-widths);

// If responsive flag enabled, loop breakpoint widths
@if $av-enable-responsive{

  @each $alias, $query in $av-breakpoints{

    // Create each media query
    @media #{$query}{
      @include av-create-widths($av-widths, #{$av-breakpoint-class-chain}#{$alias});
    }
  }
}

/*------------------------------------*\
    DEBUG
\*------------------------------------*/

// If debug flag enabled, create pseudo element
@if $av-enable-debug {

  html:after {
    background: #fbfbfb url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Q0Q4NTg0RkZBQTAzMTFFNjlBMDNDREMxREUzRTAzQjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Q0Q4NTg1MDBBQTAzMTFFNjlBMDNDREMxREUzRTAzQjQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDRDg1ODRGREFBMDMxMUU2OUEwM0NEQzFERTNFMDNCNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDRDg1ODRGRUFBMDMxMUU2OUEwM0NEQzFERTNFMDNCNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pu6fi+IAAAZDSURBVHja7FdpTJRXFH0zDDDsICAgS7Aopsri0lY0QElUBIFgWKJpQDBK0JCIdkFp1YramLbGhv5ojGlriYkIIhEQhYbIKpuiSAQUUJQtWGRRZB0Ges4EiKWWxdj4o/2SF2B4791zzz333G8kY2Nj4l0+UvGOH1llZeWbHZTJRH19vbeurq7O0qVLU4aHh9/snvnz58/5kLq6uhgaGtLNzMw80tfXZxIdHV2koaHRrlAo5g5grhqQSCTi5cuX4saNGxFg4COlUilKSkqiXVxcYgHi39eAVCoVz58/fz81NTWWv8vlcpGTk7O3t7d3LctCgHNZ0rlmTwyXL18+8vTpU1NjY+OeefPmdb548UJ+7dq142BTY84A1NTUxEyLmTI7IyMjcfPmza1FRUWbeXjTpk3fbNmy5QvsGbt9+/bHFRUVuwFKaGlpzXpJZ7MJShfUSl1dnSWEdwAZazg5OVV4eHj86uDgcH7lypW5EKU0Ly/vs46ODnuKdHR0VHVmpiVjgNm03MjIiEhLS9t77949R319fYW/v3+cubl5FwKK4ODgryDI7IaGBmtqY8eOHZEozTDPzKgpts5Mi0hbWlrWgP4I9vu6devOaWtrZxQUFIiuri5hampais9+4j7sCWlubl5PcbIrZlqyhw8fTouQGkC9tZOSkmLb2toM7OzsWgIDA4+T4p6eHm0DA4MhHR0dpbu7ezxK5FVWVrb80qVLB9GeJShN90xtLtXU1BTTLTIA2j/Jz8/3hQiHQkJC4pBx45MnT0wQ8BQ8YZWZmZnQ09NrB4jD+H0YYlyDkkTOxhdkpGq6nkeWtqjrIWQsWbhwYRFAnYP78X/OKSkpkWBIYWVlVQGWlAMDA4YokRpZy87OjlmxYkXWokWLKsnWP8aYVqEQHzI/BOptKNbW1tYPMDui0PPyO3fuBEL5DLQdbCxDcHN8/j2svXHBggWt7e3tRvCLOKKhWxLE65ZaTEzMa3uf9N29e9f3woULhwFU097ePgmgWvHZHlz4Iej3ACPNCKwJZ7R89OiRe1VV1Rp0QDBK1XD//n1vmNV7YKzJ1ta2kq1MRqfGee0sGB82+sgo5tmzZ3qOjo4N4eHhe27dutXX3d197Pr16/twbjQsLCwEgddevHjxKLOBMZ1FOfIQEFiqtsGcVtEb3NzcfkdCbWTsbxqYKhQ6HJGlp6fvhpjcoHCxcePGo6tXr/6DLQhNfIpsqpG1K1jJNzQ0rC0sLIygDcMPjoxT2xUUFHTw8ePHabW1tQ5Xr17di79j4QvKqQnLWOdXHwJCHztlZWXtGxwcFF5eXqmLFy8+z/8RALOA0n/BSga9I/CDNh8fn1PQyJCFhUUThpJAWcSSJUuykPnZjIyMSACIgnOmg52iqe8NMtjqX7IHxTIcigF6M2tr646AgIBjcDwl9xE9W5PAkGUvxdXf389gP+KzUf5NsTII9wLYt2jH9WhjOzB6yM/PbzP2DrzaFZPTkAdIPWrql5ubuxWZCVdX1x+g6koG5TtAdXW1gN2q9rN90fuCJYK4RicCo+aqn2QWLDV6e3t/h5IpS0tLPeGmoTxHMU4aXVRU1GRLwHRMz5w58xs2mqPmJTj8OTx9gGYUHx8vMIhUABgA4qQ9s1OEpaWlgEAFtCBOnz4tyBY8QBUIwOpg185IzL6zs3M5Xt/SUObuceBCNlETZnzlypX9sGYHExOT3g0bNpwAXZ0ARFbEgwcPBMComEKLqQAXFxerzjY1NQmUTDWwbGxsRHl5OUsp0KYiNDS0F9SfwL0uuMc6OTn56127doWRVe6XcsZjugkYjDtMJZwBPD09k/GKlZGQkDCZNRFPKJhCnSgBF4OzdZkEgXFvY2OjQBsLuKhAGxeDzZ9ZYnRWMO7zZ4l4n5SXQXxyZLMfo9UYrVWDun/p6+uruoABprPrCUDjb0uTDzPkWXSTwOjmHXHOzs6lKI8WBtsBlM9EVQIqFxMsFMuLTCCD+sTERA9kIR+fhOJNv7xMvHaRGVA/iG6qQwyXmpoaFyQcAZGfkMDTl508eTILvW9FxACkQG3USenbfChkZKzgxWxdGFjPzp07fWQwiW0YJkaY622ceGxN7JG87W9ATGiM/o0HnTFGi0fLbpf8578b/g/gTwEGAFEu1tcmaLvtAAAAAElFTkSuQmCC") no-repeat;
    background-size: 16px 16px;
    background-position: 4px center;
    border-color: #ddd;
    border-style: solid;
    border-width: 1px 0 0 1px;
    bottom: 0;
    color: #494949;
    content: '';
    display: none;
    font-family: monospace;
    font-size: 10px;
    height: auto;
    padding: 5px 5px 5px 24px;
    position: fixed;
    right: 0;
    width: auto;
    z-index: 100000;
  }

  // Loop breakpoint widths
  @each $alias, $query in $av-breakpoints{

    // Create each media query
    @include av-mq($alias){
      html:after {
        content: 'Breakpoint: #{$alias}';
        display: block;
      }
    }
  }
}
